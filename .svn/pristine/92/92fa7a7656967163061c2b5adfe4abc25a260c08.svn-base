<%@ Page Language="C#" AutoEventWireup="true" CodeFile="AOR_Grid.aspx.cs" Inherits="AOR_Grid" MasterPageFile="~/Grids.master" Theme="Default" %>

<asp:Content ID="cpHeadTitle" ContentPlaceHolderID="headTitle" runat="Server">AOR</asp:Content>
<asp:Content ID="cpHead" ContentPlaceHolderID="head" runat="Server">
</asp:Content>
<asp:Content ID="cpHeaderText" ContentPlaceHolderID="ContentPlaceHolderHeader" runat="Server">
	<asp:HiddenField ID="itisettings" runat="server" />
    <span>AOR</span>
</asp:Content>
<asp:Content ID="cpGridSetting" ContentPlaceHolderID="cphGridSettings" runat="Server">
    <table id="tblRelease" runat="server">
        <tr style="height: 30px;">
            <td>
                <span style="margin-left: 10px">Gridview: </span><select id="ddlGridview" runat="server"></select>
            </td>
        </tr>
    </table>
</asp:Content>
<asp:Content ID="cpPageContentInfo" ContentPlaceHolderID="cphPageContentInfo" runat="Server">
	<table style="width: 100%;">
		<tr>
			<td>
                <input type="button" id="btnAORWizard" value="AOR Wizard" style="vertical-align: middle; display: none;" />
                <input type="button" id="btnReleaseBuilder" value="Release Builder" style="vertical-align: middle; display: none;" />
                <input type="button" id="btnAdd" value="Add" style="vertical-align: middle; display: none;" />
                <input type="button" id="btnDelete" value="Delete" disabled="disabled" style="vertical-align: middle; display: none;" />
                <input type="button" id="btnEdit" value="View/Edit" disabled="disabled" style="vertical-align: middle; display: none;" />
                <input type="button" id="btnSave" value="Save" disabled="disabled" style="vertical-align: middle; display: none;" />
			<iti_Tools_Sharp:Menu ID="menuRelatedItems" runat="server" Align="Right" ClientClickEvent="openMenuItem" Text="Related&nbsp;Items&nbsp;<img id=imgRelatedItemsMenu alt=Expand Menu title=Show Related Items Options src=Images/menuDown_Black.gif />" Button="true" Style="margin-right: 10px; display: inline-block; float: right;"></iti_Tools_Sharp:Menu>
            </td>
		</tr>
	</table>
</asp:Content>
<asp:Content ID="cpBody" ContentPlaceHolderID="ContentPlaceHolderBody" runat="Server">
    <iti_Tools_Sharp:Grid ID="grdData" runat="server" AllowPaging="true" PageSize="25" FirstPageText="First" LastPageText="Last" PagerMode="NumericFirstLast" AllowResize="true"
        OnGridRowDataBound="grdData_OnGridRowDataBound" OnGridHeaderRowDataBound="grdData_OnGridHeaderRowDataBound"
		CssClass="grid" BodyCssClass="gridBody" SelectedRowCssClass="selectedRow" HeaderCssClass="gridHeader" PagerCssClass="gridPager" FooterCssClass="gridPager" AlternatingRowColor="#dfdfdf">
	</iti_Tools_Sharp:Grid>
    <script src="Scripts/multiselect/jquery.multiple.select.js" type="text/javascript"></script>
	<link rel="stylesheet" href="Styles/multiple-select.css?=2" />
    <asp:ScriptManager ID="scriptManager1" runat="server" EnablePageMethods="true"></asp:ScriptManager>
    <script src="Scripts/autosize.js"></script>
    <script id="jsVariables" type="text/javascript">
        var _pageUrls;
        var _currentLevel = '1';
        var _selectedAORID = 0, _selectedAORReleaseID = 0;
        var _selectedReleases = '';
        var _selectedContract = '';
        var _selectedTaskStatus = '';
        var _selectedSubTaskStatus = '';
    </script>

    <script id="jsEvents" type="text/javascript">
        function toggleQuickFilters_click() {
            var $imgShowQuickFilters = $('#imgShowQuickFilters');
            var $imgHideQuickFilters = $('#imgHideQuickFilters');
            var $divQuickFilters = $('#divQuickFilters');
            var addtop = 0;
            var addLeft = 0;
            if (parseInt(_currentLevel) > 1) {
                addtop = 30;
                addLeft = 5;
            }else{
                addtop = 58;
                addLeft = 273;
            }

            if ($imgShowQuickFilters.is(':visible')) {
                $imgShowQuickFilters.hide();
                $imgHideQuickFilters.show();

                var pos = $imgShowQuickFilters.position();
                $divQuickFilters.css({
                    width: '300px',
                    position: 'absolute',
                    top: (pos.top + addtop) + 'px',
                    left: (pos.left + addLeft) + 'px'
                }).slideDown();
            }
            else if ($imgHideQuickFilters.is(':visible')) {
                $imgHideQuickFilters.hide();
                $imgShowQuickFilters.show();

                var pos = $imgHideQuickFilters.position();
                $divQuickFilters.css({
                    width: '300px',
                    position: 'absolute',
                    top: (pos.top + addtop) + 'px',
                    left: (pos.left + addLeft) + 'px'
                }).slideUp();
            }
        }

        function relatedItems_click(action, type) {
            var nWindow = 'EntityMassChange';
            var nTitle = 'Mass Change Wizard';
            var nHeight = 325, nWidth = 500;
            var nURL = _pageUrls.Maintenance.MassChangeWizard + window.location.search;
            var openPopup = popupManager.AddPopupWindow(nWindow, nTitle, 'Loading.aspx?Page=' + nURL, nHeight, nWidth, 'PopupWindow', this);

            if (openPopup) openPopup.Open();
		}

		function openMenuItem(url) {
			if (url.indexOf("relatedItems") > 0) {
				var str = url.split("'");
				relatedItems_click(str[1], str[3]);
			}
		}

        function ddlRelease_update() {
            var arrRelease = $('#<%=Master.FindControl("ms_Item0").ClientID %>').multipleSelect('getSelects');
			
            _selectedReleases = arrRelease.join(',');

            resizeFrame();
        }

        function ddlRelease_close() {
            refreshPage(false);
        }

        function ddlContract_update() {
            var arrContract = $('#<%=Master.FindControl("ms_Item1").ClientID %>').multipleSelect('getSelects');
			
            _selectedContract = arrContract.join(',');

            resizeFrame();
        }

        function ddlContract_close() {
            refreshPage(false);
        }

        function ddlTaskStatus_update() {
            var arrTaskStatus = $('#<%=Master.FindControl("ms_Item9").ClientID %>').multipleSelect('getSelects');

            _selectedTaskStatus = arrTaskStatus.join(',');
            resizeFrame();
        }

        function ddlSubTaskStatus_update() {
            var arrSubTaskStatus = $('#<%=Master.FindControl("ms_Item9a").ClientID %>').multipleSelect('getSelects');

            _selectedSubTaskStatus = arrSubTaskStatus.join(',');
            resizeFrame();
        }


        function imgRefresh_click() {
            refreshPage(false);
        }

        function imgSettings_click() {
        	openSettings();
        }

        function linkResouces_click(aorid) {
            var nWindow = 'AORResources';
            var nTitle = 'AOR Resources';
            var nHeight = 700, nWidth = 1000;
            var nURL = _pageUrls.Maintenance.AORPopup + window.location.search + '&Type=Resources' + '&AORID=' + aorid;
            var openPopup = popupManager.AddPopupWindow(nWindow, nTitle, 'Loading.aspx?Page=' + nURL, nHeight, nWidth, 'PopupWindow', this);

            if (openPopup) openPopup.Open();
        }

        function btnAORWizard_click() {
            var nWindow = 'AORWizard';
            var nTitle = 'AOR Wizard';
            var nHeight = 400, nWidth = 1200;
            var nURL = _pageUrls.Maintenance.AORWizard + window.location.search;

            if ($('.selectedRow').length == 1 && '<%=this.DCC.Contains("AOR Name") %>'.toUpperCase() == 'TRUE') {
                var txtAORName = $('.selectedRow td:eq(<%=this.DCC.IndexOf("AOR Name") %>)').find('input[type=text]').val();

                nURL += '&AORName=' + txtAORName;
            }

            var openPopup = popupManager.AddPopupWindow(nWindow, nTitle, 'Loading.aspx?Page=' + nURL, nHeight, nWidth, 'PopupWindow', this);

            if (openPopup) openPopup.Open();
        }

        function btnReleaseBuilder_click() {
            var nWindow = 'ReleaseBuilder';
            var nTitle = 'Release Builder';
            var nHeight = 700, nWidth = 1000;
            var nURL = _pageUrls.Maintenance.AORReleaseBuilder + window.location.search;
            var openPopup = popupManager.AddPopupWindow(nWindow, nTitle, 'Loading.aspx?Page=' + nURL, nHeight, nWidth, 'PopupWindow', this);

            if (openPopup) openPopup.Open();
        }

        function btnAdd_click() {
            var nWindow = 'AddAOR';
            var nTitle = 'Add AOR';
            var nHeight = 346, nWidth = 1000;
            var nURL = _pageUrls.Maintenance.AORPopup + window.location.search + '&Type=AOR';
            var openPopup = popupManager.AddPopupWindow(nWindow, nTitle, 'Loading.aspx?Page=' + nURL, nHeight, nWidth, 'PopupWindow', this);

            if (openPopup) openPopup.Open();

            //if (parent.showFrameForEdit) {
            //    parent.showFrameForEdit('AOR', true, 0, true);
            //}
            //else {
            //    var nWindow = 'AOR';
            //    var nTitle = 'AOR';
            //    var nHeight = 700, nWidth = 1000;
            //    var nURL = _pageUrls.Maintenance.AORTabs + window.location.search + '&NewAOR=true&AORID=0';
            //    var openPopup = popupManager.AddPopupWindow(nWindow, nTitle, 'Loading.aspx?Page=' + nURL, nHeight, nWidth, 'PopupWindow', this);

            //    if (openPopup) openPopup.Open();
            //}
        }

        function ddlGridView_change() {
            var gridViewId = $("#<%=ddlGridview.ClientID %> option:selected").val();
            var gridView = "AOR";

            PageMethods.GetTier1Data(gridViewId, gridView, ddlGridView_Change_Done, on_error);
        }

        function ddlGridView_Change_Done(results) {
            $(defaultParentPage.itisettings).text(results);
            $("#<%= itisettings.ClientID %>").val(results);
            refreshPage(false);
        }

        function btnDelete_click() {
            QuestionBox('Confirm AOR Delete', 'Are you sure you want to delete this AOR? All history will be lost and it will be disassociated from all meetings.', 'Yes,No', 'confirmAORDelete', 300, 300, this);
        }

        function confirmAORDelete(answer) {
            if ($.trim(answer).toUpperCase() == 'YES') {
                try {
                    ShowDimmer(true, 'Deleting...', 1);

                    PageMethods.DeleteAOR(_selectedAORID, delete_done, on_error);
                }
                catch (e) {
                    ShowDimmer(false);
                    MessageBox('An error has occurred.');
                }
            }
        }

        function delete_done(result) {
            ShowDimmer(false);

            var blnDeleted = false;
            var errorMsg = '';
            var obj = $.parseJSON(result);

            if (obj) {
                if (obj.deleted && obj.deleted.toUpperCase() == 'TRUE') blnDeleted = true;
                if (obj.error) errorMsg = obj.error;
            }

            if (blnDeleted) {
                MessageBox('AOR has been deleted.');
                refreshPage(true);
            }
            else {
                MessageBox('Failed to delete. <br>' + errorMsg);
            }
        }

        function btnEdit_click() {
            var obj = parent;

            for (var i = 1; i < parseInt(_currentLevel); i++) {
                obj = obj.parent;
            }

            if (obj.showFrameForEdit) {
                obj.showFrameForEdit('AOR', false, _selectedAORID, true, _selectedAORReleaseID);
            }
            else {
                var nWindow = 'AOR';
                var nTitle = 'AOR';
                var nHeight = 700, nWidth = 1000;
                var nURL = _pageUrls.Maintenance.AORTabs + window.location.search + '&NewAOR=false&AORID=' + _selectedAORID + '&AORReleaseID=' + _selectedAORReleaseID;
                var openPopup = popupManager.AddPopupWindow(nWindow, nTitle, 'Loading.aspx?Page=' + nURL, nHeight, nWidth, 'PopupWindow', this);

                if (openPopup) openPopup.Open();
            }
        }

        function btnSave_click() {
            try {
                var validation = validate();

                if (validation.length == 0) {
                    var arrChanges = [];

                    $('span[fieldChanged="1"],textarea[fieldChanged="1"],input[fieldChanged="1"], select[fieldChanged="1"]').each(function() {
                        var $obj = $(this);
                        var objVal = '';
                        if ($obj.find('input[type=checkbox]').is(':checkbox')){
                            objVal = $obj.find('input[type=checkbox]').prop('checked')? 1: 0;
                        }
                        else{
                            objVal = $obj.val();
                        }

                        arrChanges.push({'typeName': $obj.attr('typeName'),'typeID': $obj.attr('typeID'), 'field': $obj.attr('field'), 'value': objVal});
                    });

                    if (arrChanges.length > 0) {
                        ShowDimmer(true, 'Saving...', 1);

                        var nJSON = '{update:' + JSON.stringify(arrChanges) + '}';

                        PageMethods.SaveChanges(nJSON, save_done, on_error);
                    }
                    else {
                        MessageBox('You have not made any changes.');
                    }
                }
                else {
                    MessageBox('Invalid entries: <br><br>' + validation);
                }
            }
            catch (e) {
                ShowDimmer(false);
                MessageBox('An error has occurred.');
            }
        }

        function save_done(result) {
            ShowDimmer(false);

            var blnSaved = false;
            var errorMsg = '';
            var obj = $.parseJSON(result);

            if (obj) {
                if (obj.saved && obj.saved.toUpperCase() == 'TRUE') blnSaved = true;
                if (obj.error) errorMsg = obj.error;
            }

            if (blnSaved) {
                var fieldCount = $('span[fieldChanged="1"],textarea[fieldChanged="1"],input[fieldChanged="1"], select[fieldChanged="1"]').length;
                var rowCount = $('tr[rowChanged="1"]').length;

                MessageBox(fieldCount + ' item(s) in ' + rowCount + ' row(s) have been saved.');
                refreshPage(true);
            }
            else {
                MessageBox('Failed to save. <br>' + errorMsg);
            }
        }

        function on_error() {
            ShowDimmer(false);
            MessageBox('An error has occurred.');
        }

        function validate() {
            var validation = [];
            
            $.each($('#<%=this.grdData.ClientID %>_BodyContainer table input[field="AOR Name"]'), function() {
                var nText = $(this).val();
                
                if (nText.length == 0) {
                    if ($.inArray('AOR Name cannot be empty.', validation) == -1) validation.push('AOR Name cannot be empty.');
                }

                if ($('#<%=this.grdData.ClientID %>_BodyContainer table input[field="AOR Name"][value="' + nText + '"]').not($(this)).length > 0) {
                    if ($.inArray('AOR Name cannot have duplicates.', validation) == -1) validation.push('AOR Name cannot have duplicates.');
                }
            });

            return validation.join('<br>');
        }

        function imgExport_click() {
            var url = window.location.href;
            url = editQueryStringValue(url, 'Export', true);
            window.location.href = url;
        }

    	function openSettings() {
    		if (parent.openSettings) {
    			parent.openSettings();
    			return;
    		}

            var nTitle = 'AOR PARAMETERS';
            var nHeight = 800, nWidth = 700;
    		var nURL = 'ITI_Settings.aspx?GridView=AOR&ActiveTab=1';
    		var openPopup = popupManager.AddPopupWindow('ITI_Settings', nTitle, 'Loading.aspx?Page=' + nURL, nHeight, nWidth, 'PopupWindow', this);

    		if (openPopup) openPopup.Open();
    	}

    	function displayAllRows(obj) {
    	    var $obj = $(obj);

    	    $('#<%=this.grdData.ClientID %>_BodyContainer table td img').each(function () {
    	        $(this).click();
    	    });

    	    if ($obj.attr('title') == 'Expand') {
    	        $obj.attr('src', 'Images/Icons/minus_blue.png');
    	        $obj.attr('title', 'Collapse');
    	        $obj.attr('alt', 'Collapse');
    	    }
    	    else {
    	        $obj.attr('src', 'Images/Icons/add_blue.png');
    	        $obj.attr('title', 'Expand');
    	        $obj.attr('alt', 'Expand');

    	    }
    	}

        function displayNextRow(obj) {
            var $obj = $(obj);

            if ($obj.attr('title') != 'Loading...') {
                var $row = $obj.closest('tr');
                var blnShow = true;

                if ($row.next().find('iframe').length === 0) {
                    $obj.attr('src', 'Images/Loaders/loader_2.gif');
                    $obj.attr('title', 'Loading...');
                    $obj.attr('alt', 'Loading...');
                    $obj.css('cursor', 'default');

                    var nURL = '';

                    if (_currentLevel === '<%=this.LevelCount %>') {
                        return;
                    }
                    else {
                        nURL = 'AOR_Grid.aspx' + window.location.search;
                        nURL = editQueryStringValue(nURL, 'CurrentLevel', (parseInt(_currentLevel) + 1));
                    }

                    var filters = [];
                    var headerIndex = 1;

                    if ('<%=hasDoubleHeader %>' == 'True'){
                        headerIndex = 2;
                    }

                    $.each($row.find('td'), function(i) {
                        var nText = $('.gridHeader:eq(' + headerIndex + ') th:eq(' + i + ')').text();
                        var nVal = encodeURIComponent($(this).text());

                        if (nText.match(/_ID$/)) filters.push(nText + '=' + nVal);
                    });

                    nURL = editQueryStringValue(nURL, 'Filter', ('<%=this.Filter %>' !== '' ? encodeURIComponent('<%=this.Filter %>|') : '') + filters.join('|'));

                    var nHTML = '<tr>';
                    nHTML += '<td colspan=' + $row.find('td:visible').length + ' style="padding-top: 5px; border: none; border-bottom: 1px solid grey;">';
                    nHTML += '<table style="border-collapse: collapse; width: 100%;">';
                    nHTML += '<tr>';
                    nHTML += '<td style="width: 15px; vertical-align: top;">';
                    nHTML += '<img src="Images/Icons/tree_branch.gif" alt="Child Grid" />';
                    nHTML += '</td>';
                    nHTML += '<td>';
                    nHTML += '<iframe src=' + nURL + ' width="100%" height="' + $row.height() + 'px" frameBorder="0"></iframe>';
                    nHTML += '</td>';
                    nHTML += '</tr>';
                    nHTML += '</table>';
                    nHTML += '</td>';
                    nHTML += '</tr>';

                    $(nHTML).insertAfter($row);
                }
                else {
                    if ($row.next().is(':visible')) blnShow = false;
                }

                if (blnShow) {
                    if ($obj.attr('title') == 'Expand') {
                        $obj.attr('src', 'Images/Icons/minus_blue.png');
                        $obj.attr('title', 'Collapse');
                        $obj.attr('alt', 'Collapse');
                    }

                    $row.next().show();
                }
                else {
                    $obj.attr('src', 'Images/Icons/add_blue.png');
                    $obj.attr('title', 'Expand');
                    $obj.attr('alt', 'Expand');
                    $row.next().hide();
                }

                resizeFrame();
            }
        }

        function row_click(obj) {
            if ($(obj).attr('aor_id')) {
                _selectedAORID = $(obj).attr('aor_id');

                $('#btnDelete').prop('disabled', false);
                $('#btnEdit').prop('disabled', false);
            }

            if ($(obj).attr('aorrelease_id')) {
                _selectedAORReleaseID = $(obj).attr('aorrelease_id');

                $('#btnEdit').prop('disabled', false);
            }
        }

        function input_change(obj) {
            var $obj = $(obj);
            
            switch($obj.attr('field')) {
                case 'Description':
                    autosize($obj);
                    resizeGrid();
                    break;
                case 'Sort':
                    var nVal = $obj.val();
                    var blnNegative = nVal.indexOf('-') != -1 ? true : false;
                    
                    nVal = nVal.replace(/[^\d]/g, '');
                    
                    if (blnNegative) nVal = '-' + nVal;

                    $obj.val(nVal);
                    break;
            }

            $obj.attr('fieldChanged', '1');
            $obj.closest('tr').attr('rowChanged', '1');
            $('#btnSave').prop('disabled', false);

        }

        function txtBox_blur(obj) {
            var $obj = $(obj);
            var nVal = $obj.val();

            switch($obj.attr('field')) {
                case 'Sort':
                    if (nVal == '-') $obj.val('');
                    return;
            }

            $obj.val($.trim(nVal));
        }

        function lbEditWorkItem_click(recordId) {
            var UseLocal = false; //to use local storage enabling next/previous on task edit page, or to not, that is the question. 
            
            var obj = parent;

            for (var i = 1; i < parseInt(_currentLevel); i++) {
                obj = obj.parent;
            }

            if (obj.showFrameForEdit) {
                obj.showFrameForEdit('TASK', false, recordId, true);
            }
            else {
                var title = '', url = '';
                var h = 700, w = 1200;

                title = 'Work Item - [' + recordId + ']';
                url = _pageUrls.Maintenance.WorkItemEditParent
					+ '?WorkItemID=' + recordId
                    + '&UseLocal=True';

                //open in a popup
                var openPopup = popupManager.AddPopupWindow('WorkItem', title, 'Loading.aspx?Page=' + url, h, w, 'PopupWindow', this);
                if (openPopup) {
                    openPopup.Open();
                }
            }
        }

        function openWorkItem(workItemID, taskNumber, taskID, blnSubTask) {
            var nWindow = 'WorkTask';
            var nTitle = 'Work Task';
            var nHeight = 700, nWidth = 1200;
            var nURL = _pageUrls.Maintenance.WorkItemEditParent;

            if (parseInt(workItemID) > 0) {
                nTitle += ' - [' + workItemID + ']';
                nURL += '?workItemID=' + workItemID;
            }

            if (blnSubTask == '1') {
                nWindow = 'WorkSubTask';
                nTitle = 'Work Sub-Task - [' + workItemID + ' - ' + taskNumber + ']';
                nHeight = 700, nWidth = 850;
                nURL = _pageUrls.Maintenance.TaskEdit + '?workItemID=' + workItemID + '&taskID=' + taskID;
            }

            var openPopup = popupManager.AddPopupWindow(nWindow, nTitle, 'Loading.aspx?Page=' + nURL, nHeight, nWidth, 'PopupWindow', this);

            if (openPopup) openPopup.Open();
        }

        function openCR(CRID) {
            var nWindow = 'CR';
            var nTitle = 'CR';
            var nHeight = 700, nWidth = 1000;
            var nURL = _pageUrls.Maintenance.AORCRTabs + window.location.search + '&NewCR=false&CRID=' + CRID;
            var openPopup = popupManager.AddPopupWindow(nWindow, nTitle, 'Loading.aspx?Page=' + nURL, nHeight, nWidth, 'PopupWindow', this);

            if (openPopup) openPopup.Open();
        }
 
        function refreshPage(blnRetainPageIndex) {
            ddlContract_update();
            ddlRelease_update();

            ddlTaskStatus_update();
            ddlSubTaskStatus_update();

            var nURL = window.location.href.replace('#', '');
        	nURL = editQueryStringValue(nURL, 'SelectedReleases', _selectedReleases);
        	nURL = editQueryStringValue(nURL, 'SelectedContract', _selectedContract);

            nURL = editQueryStringValue(nURL, 'SelectedTaskStatus', _selectedTaskStatus);
            nURL = editQueryStringValue(nURL, 'SelectedSubTaskStatus', _selectedSubTaskStatus);
            nURL = editQueryStringValue(nURL, 'GridPageSize', $('#<%=Master.FindControl("ddlItem5").ClientID %>').val());
        	if($(defaultParentPage.itisettings).text() !== "") $("#<%=itisettings.ClientID %>").val($(defaultParentPage.itisettings).text());
        	nURL = editQueryStringValue(nURL, 'GridPageIndex', blnRetainPageIndex ? '<%=this.grdData.PageIndex %>' : '0');
        	PageMethods.UpdateSession($(defaultParentPage.itisettings).text());
            window.location.href = 'Loading.aspx?Page=' + nURL;
        }

        function resizeGrid() {
            setTimeout(function() { <%=this.grdData.ClientID %>.ResizeGrid(); }, 1);
        }

        function resizeFrame() {
            var $grid = $('#<%=this.grdData.ClientID %>_Grid');
            var headerTop = itiGrid_getAbsoluteTop($grid[0]);
            var bodyTableHeight = $('#<%=this.grdData.ClientID %>_BodyContainer table').height();
            var pagerHeight = $('#<%=this.grdData.ClientID %>_PagerContainer').is(':visible') ? $('#<%=this.grdData.ClientID %>_PagerContainer').height() : 0;

            if (parseInt(_currentLevel) > 1) {
                var nHeight = headerTop + bodyTableHeight + pagerHeight + 1;
                var nFrame = getMyFrameFromParent();

                $(nFrame).height(nHeight);
                resizeGrid();
                if (parent.resizeFrame) parent.resizeFrame();
            }
            else {
                resizeGrid();
                
                var bodyHeight = $('#<%=this.grdData.ClientID %>_BodyContainer').height(); 
                if (bodyTableHeight < bodyHeight) bodyHeight = bodyTableHeight - pagerHeight + 3;
                var pagerTop = headerTop + bodyHeight + pagerHeight - 5;
                $('#<%=this.grdData.ClientID %>_PagerContainer').css('top', pagerTop + 'px');
            }
        }

        function completeLoading() {
            var nFrame = getMyFrameFromParent();
            var $obj = $(nFrame).parents().eq(5).prev().find('td:eq(0) img'); //innerTD, innerTR, innerTBODY, innerTABLE, outerTD, outerTR, previousOuterTR

            $obj.attr('src', 'Images/Icons/minus_blue.png');
            $obj.attr('title', 'Collapse');
            $obj.attr('alt', 'Collapse');
            $obj.css('cursor', 'pointer');
        }
    </script>

    <script id="jsInit" type="text/javascript">
        function initVariables() {
            _pageUrls = new PageURLs();
            _currentLevel = '<%=this.CurrentLevel %>';
        }

        function initDisplay() {
            $('#imgSort').hide();
            
            $('#trClearAll').hide();
            $('#tdQuickFilters').show();

            if ('<%=this.CanEditAOR %>'.toUpperCase() == 'TRUE') {
                if (parseInt(_currentLevel) == 1 || '<%=this.DCC.Contains("AOR_ID") %>'.toUpperCase() === 'TRUE') $('#btnAORWizard').show();

                if (parseInt(_currentLevel) == 1) {
                    $('#btnReleaseBuilder').show();
                    $('#btnAdd').show();
                }

                if ($('.saveable').length > 0) {
                    $('#btnDelete').show();
                    $('#btnSave').show();
                }
            }

            if ('<%=this.CanViewAOR %>'.toUpperCase() === 'TRUE' && '<%=this.grdData.Rows.Count %>' !== '0' && '<%=this.DCC.Contains("AOR_ID") %>'.toUpperCase() === 'TRUE') $('#btnEdit').show();

            if (parseInt(_currentLevel) > 1) {
                $('#pageContentHeader').hide();
                $('#<%=menuRelatedItems.ClientID %>').hide();
                $('#trItem5').show();
                $('#trms_Item0').hide();
                $('#trms_Item1').hide();
                $('#trms_Item9').hide();
                $('#imgExport').hide();

                if(<%=gridRowCnt%> <= 12){
                    $('#tdQuickFilters').hide();
                }

                resizeFrame();
                completeLoading();
            }
            else {
                $('#trms_Item0').show();
                $('#trms_Item1').show();
                $('#trms_Item9').show();
                $('#tdSettings').show();
                $('#trItem5').hide();
                $('#imgExport').show();
				resizeGrid();
            }
        }

        function initEvents() {
            var lblMessage = $('#<%=Master.FindControl("lblMessage").ClientID %>');

            $('#imgExport').click(function () { imgExport_click(); });
        	$('#imgRefresh').click(function () { imgRefresh_click(); });
        	$('#imgSettings').click(function () { imgSettings_click(); });
        	$('#btnAORWizard').click(function () { btnAORWizard_click(); return false; });
        	$('#btnReleaseBuilder').click(function () { btnReleaseBuilder_click(); return false; });
            $('#btnAdd').click(function () { btnAdd_click(); return false; });
            $('#btnDelete').click(function () { btnDelete_click(); return false; });
            $('#btnEdit').click(function () { btnEdit_click(); return false; });
            $('#btnSave').click(function () { btnSave_click(); return false; });
            $('.gridBody').on('click', function () { row_click(this); });
            $('.selectedRow').on('click', function () { row_click(this); });
            $('#btnQuickFilters').click(function () { toggleQuickFilters_click(); });

            $('#<%=Master.FindControl("ddlItem5").ClientID %>').on('change', function () { 
                lblMessage.show();
                lblMessage.text('<< Click Refresh icon to apply Quick Filter(s)');
            });
            $('#<%=Master.FindControl("ms_Item0").ClientID %>').multipleSelect({
                placeholder: 'Default'
                , width: 'undefined'
                , onClick: function () {
                    lblMessage.show();
                    lblMessage.text('<< Click Refresh icon to apply Quick Filter(s)');
                },
                onCheckAll: function () {
                    lblMessage.show();
                    lblMessage.text('<< Click Refresh icon to apply Quick Filter(s)');
                }
				,onOpen: function() { ddlRelease_update(); }
            }).change(function () { ddlRelease_update(); });

            $('#<%=Master.FindControl("ms_Item1").ClientID %>').multipleSelect({
                placeholder: 'Default'
                , width: 'undefined'
                , onClick: function () {
                    lblMessage.show();
                    lblMessage.text('<< Click Refresh icon to apply Quick Filter(s)');
                },
                onCheckAll: function () {
                    lblMessage.show();
                    lblMessage.text('<< Click Refresh icon to apply Quick Filter(s)');
                }
					,onOpen: function() { ddlContract_update(); }
            }).change(function () { ddlContract_update(); });

            $('#<%=Master.FindControl("ms_Item9").ClientID %>').multipleSelect({
                placeholder: 'Default'
                , width: 'undefined'
                , onClick: function () {
                    lblMessage.show();
                    lblMessage.text('<< Click Refresh icon to apply Quick Filter(s)');
                },
                onCheckAll: function () {
                    lblMessage.show();
                    lblMessage.text('<< Click Refresh icon to apply Quick Filter(s)');
                }
            });

            $('#<%=Master.FindControl("ms_Item9a").ClientID %>').multipleSelect({
                placeholder: 'Default',
                width: 'undefined',
                onClick: function() {
                    lblMessage.show();
                    lblMessage.text('<< Click Refresh icon to apply Quick Filter(s)');
                },
                onCheckAll: function() {
                    lblMessage.show();
                    lblMessage.text('<< Click Refresh icon to apply Quick Filter(s)');
                }
            });

            lblMessage.hide();
        }

        $(document).ready(function () {
			if($(defaultParentPage.itisettings).text() === "") $(defaultParentPage.itisettings).text($("#<%=itisettings.ClientID %>").val());
            if ('<%=IsConfigured.ToString().ToUpper() %>' === 'FALSE') openSettings();
            var data = JSON.parse($(defaultParentPage.itisettings).text());
            initVariables();
            initDisplay();
            initEvents();

            $('#<%=ddlGridview.ClientID %>').on("change", function () { ddlGridView_change(); return false; });
            $("#<%=ddlGridview.ClientID %> option[OptionGroup='Process Views']").wrapAll("<optgroup label='Process Views'>");
            $("#<%=ddlGridview.ClientID %> option[OptionGroup='Custom Views']").wrapAll("<optgroup label='Custom Views'>");
            $('#<%=ddlGridview.ClientID %> option').filter(function () { return $.trim($(this).text()) === data.viewname; }).prop('selected', true);
        });
    </script>
</asp:Content>
