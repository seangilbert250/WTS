<%@ Page Language="C#" AutoEventWireup="true" CodeFile="RQMT_Edit.aspx.cs" Inherits="RQMT_Edit" MasterPageFile="~/EditTabs.master" Theme="Default" %>

<asp:Content ID="cpHeadTitle" ContentPlaceHolderID="headTitle" runat="Server">RQMT</asp:Content>
<asp:Content ID="cpHead" ContentPlaceHolderID="head" runat="Server">
    <!-- Copyright (c) 2017 Infinite Technologies, Inc. -->
</asp:Content>
<asp:Content ID="cpHeaderImage" ContentPlaceHolderID="ContentPlaceHolderHeaderImage" runat="Server">
    
</asp:Content>
<asp:Content ID="cpHeaderText" ContentPlaceHolderID="ContentPlaceHolderHeaderText" runat="Server"></asp:Content>
<asp:Content ID="cpHeaderButtons" ContentPlaceHolderID="ContentPlaceHolderHeaderButtons" runat="Server">
	<input type="button" id="btnCancel" value="Cancel" style="vertical-align: middle; display: none;" />
    <input type="button" id="btnSave" value="Save" disabled="disabled" style="vertical-align: middle; display: none;" />
</asp:Content>
<asp:Content ID="cpBody" ContentPlaceHolderID="ContentPlaceHolderBody" runat="Server">
    <div id="divPageContainer" style="overflow-x: hidden; overflow-y: auto;padding:2px;">

        <div id="divTabsContainer" class="" style="width:100%;padding: 0px;overflow:hidden;">                        
            <div id="divTabsContainerTabRow" style="width:2000px;overflow:hidden;">
			    <ul style="background:none;border:0px;padding:0px;position:relative;">
				    <li><a id="tab_rqmtdetails" href="#div_tabrqmtdetails">Details</a></li>                        
			    </ul>                            
            </div>                        
            <div id="div_tabrqmtdetails" class="tabDiv" style="width:98%;padding:3px;">
                <div id="div_detailssectioncontainer" style="padding-bottom:5px;">
				    <div class="pageContentHeader" style="vertical-align: top; padding: 5px;">
					    <img class="toggleSection" src="Images/Icons/minus_blue.png" title="Show Section" alt="Show Section" height="12" width="12" data-section="details" style="cursor: pointer;" />&nbsp;&nbsp;<span>Details</span>
				    </div>
                    <div id="section_details" style="padding-bottom:5px;">
                        <table style="width: 100%;">
                            <tr>
                                <td style="width: 5px;">
                                    &nbsp;
                                </td>
                                <td style="width: 65px;">
                                    RQMT #:
                                </td>
                                <td>
                                    <span id="spnRQMT" runat="server">-</span>
                                    <div id="divInfo" style="float: right; display: none;"><span id="spnCreated" runat="server" style="font-size:smaller;"></span><span id="spnUpdated" runat="server" style="padding-left: 30px;font-size:smaller;"></span></div>
                                </td>
                                <td style="width: 5px;">
                                    &nbsp;
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <span style="color: red;">*</span>
                                </td>
                                <td>
                                    RQMT:
                                </td>
                                <td>
                                    <asp:TextBox ID="txtRQMT" runat="server" MaxLength="150" Width="100%" ReadOnly="true" ForeColor="Gray"></asp:TextBox>
                                </td>
                                <td>
                                    &nbsp;
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div id="div_associationssectioncontainer" style="padding-bottom:5px;">
				    <div class="pageContentHeader" style="vertical-align: top; padding: 5px;">
					    <img class="toggleSection" src="Images/Icons/add_blue.png" title="Show Section" alt="Show Section" height="12" width="12" data-section="associations" style="cursor: pointer;" />&nbsp;&nbsp;<span>Associations</span>
				    </div>
                    <div id="section_associations" style="padding-bottom:5px;display:none;">
                    </div>
                </div>

                <div id="div_attributessectioncontainer" style="padding-bottom:5px;">
				    <div class="pageContentHeader" style="vertical-align: top; padding: 5px;">
					    <img class="toggleSection" src="Images/Icons/add_blue.png" title="Show Section" alt="Show Section" height="12" width="12" data-section="attributes" style="cursor: pointer;" />&nbsp;&nbsp;<span>Attributes</span>
				    </div>
                    <div id="section_attributes" style="padding-bottom:5px;display:none;">
                    </div>
                </div>

                <div id="div_descriptionssectioncontainer" style="padding-bottom:5px;">
				    <div class="pageContentHeader" style="vertical-align: top; padding: 5px;">
					    <img class="toggleSection" src="Images/Icons/add_blue.png" title="Show Section" alt="Show Section" height="12" width="12" data-section="descriptions" style="cursor: pointer;" />&nbsp;&nbsp;<span>Descriptions</span>
				    </div>
                    <div id="section_descriptions" style="padding-bottom:5px;display:none;">
                    </div>
                </div>
            </div>
        </div> 
    </div>

    <asp:ScriptManager ID="scriptManager1" runat="server" EnablePageMethods="true"></asp:ScriptManager>

    <script id="jsEvents" type="text/javascript">
        function imgRefresh_click() {
            refreshPage();
        }

        function btnCancel_click() {
            refreshPage();
        }

        function btnSave_click() {
            try {
                var validation = validate();
                var blnAltered = 0;

                if (validation.length == 0) {
                    ShowDimmer(true, 'Saving...', 1);

                    PageMethods.Save('<%=this.NewRQMT %>', '<%=this.RQMTID %>', $('#<%=this.txtRQMT.ClientID %>').val(), save_done, on_error);
                }
                else {
                    MessageBox('Invalid entries: <br><br>' + validation);
                }
            }
            catch (e) {
                ShowDimmer(false);
                MessageBox('An error has occurred.');
            }
        }

        function save_done(result) {
            ShowDimmer(false);

            var blnSaved = false, blnExists = false;
            var newID = '', errorMsg = '';
            var obj = $.parseJSON(result);

            if (obj) {
                if (obj.saved && obj.saved.toUpperCase() == 'TRUE') blnSaved = true;
                if (obj.exists && obj.exists.toUpperCase() == 'TRUE') blnExists = true;
                if (obj.newID && (parseInt(obj.newID) < 0 || parseInt(obj.newID) > 0)) newID = obj.newID;
                if (obj.error) errorMsg = obj.error;
            }

            if (blnSaved) {
                if (parent.parent._newItemCreated != undefined) parent.parent._newItemCreated = true;

                MessageBox('RQMT has been saved.');

                if ($('#<%=this.txtRQMT.ClientID %>').val() != $('#<%=this.txtRQMT.ClientID %>').attr('original_value') && parent.refreshPage) {
				    parent.refreshPage(newID);
				}
				else {
				    refreshPage(newID);
				}
            }
            else if (blnExists) {
                MessageBox('RQMT already exists.');
            }
            else {
                MessageBox('Failed to save. <br>' + errorMsg);
            }
        }

        function on_error() {
            ShowDimmer(false);
            MessageBox('An error has occurred.');
        }

        function validate() {
            var validation = [];

            if ($('#<%=this.txtRQMT.ClientID %>').val().length == 0) validation.push('RQMT cannot be empty.');

            return validation.join('<br>');
        }

        function input_change(obj) {
            var $obj = $(obj);
            var nVal = $obj.val();

            $('#btnSave').prop('disabled', false);
        }

        function txtBox_blur(obj) {
            var $obj = $(obj);
            var nVal = $obj.val();

            $obj.val($.trim(nVal));
        }

        function refreshPage(newID) {
            var nURL = window.location.href;

            if (newID != undefined && (parseInt(newID) < 0 || parseInt(newID) > 0)) {
                if (parent.refreshPage) parent.refreshPage(newID);
            }

            window.location.href = 'Loading.aspx?Page=' + nURL;
        }

        function resizePage() {
            resizePageElement('divPageContainer');
        }

        function toggleSection(img) {
            var section = $(img).attr('data-section');
            var div = $('#section_' + section);
            div.toggle();

            if (div.is(':visible')) {
                $(img).attr('src', 'images/icons/minus_blue.png');
            }
            else {
                $(img).attr('src', 'images/icons/add_blue.png');
            }
        }
    </script>

    <script id="jsInit" type="text/javascript">
        function initDisplay() {
            $('#imgRefresh').hide();

            if ('<%=this.CanEditRQMT %>'.toUpperCase() == 'TRUE') {
                $('input[type="text"], textarea').css('color', 'black');
                $('input[type="text"], textarea').not('.date').removeAttr('readonly');
                $('select, input[type="checkbox"]').removeAttr('disabled');
                $('#btnCancel').show();
                $('#btnSave').show();
            }

            if ('<%=this.NewRQMT %>'.toUpperCase() == 'FALSE') $('#divInfo').show();

            resizePage();
            $('#divTabsContainer').tabs();
        }

        function initEvents() {
            $('#imgRefresh').click(function () { imgRefresh_click(); });
            $('#btnCancel').click(function () { btnCancel_click(); return false; });
            $('#btnSave').click(function () { btnSave_click(); return false; });
            $('input[type="text"], textarea').on('keyup paste', function () { input_change(this); });
            $('select, input[type="checkbox"]').on('change', function () { input_change(this); });
            $('input[type="text"], textarea').on('blur', function () { txtBox_blur(this); });
            $('.toggleSection').on('click', function () { toggleSection(this); });
            $(window).resize(resizePage);
        }

        $(document).ready(function () {
            initDisplay();
            initEvents();
        });
    </script>
</asp:Content>