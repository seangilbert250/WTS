<%@ Page Language="C#" AutoEventWireup="true" CodeFile="News_AddEdit.aspx.cs" Inherits="News_AddEdit" Theme="Default" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title></title>
    <script type="text/javascript" src="Scripts/shell.js"></script>
	<script type="text/javascript" src="Scripts/common.js"></script>
	<script type="text/javascript" src="Scripts/jquery-1.11.2.js"></script>
    <script type="text/javascript" src="Scripts/jquery-ui.js"></script>
    <link rel="stylesheet" href="Styles/jquery-ui.css" />
    <link rel="stylesheet" href="Scripts/cleditor/jquery.cleditor.css" />
</head>
<body>
    <form id="form1" runat="server">
        <asp:ScriptManager ID="scriptManager1" runat="server" EnablePageMethods="true"></asp:ScriptManager>
        <div style="height: 98%">
            <table cellpadding="0" cellspacing="0" style="padding: 10px;">
                <tr>
                    <td style="text-align: right; color: Red; padding-right: 5px; padding-bottom: 10px">* 
                    </td>
                    <td style="padding-bottom: 10px">
                        <asp:Label ID="lblArticleTitle" runat="server" Text="Article Title: "></asp:Label>
                    </td>
                    <td style="padding-bottom: 10px">
                        <asp:TextBox ID="txtArticleTitle" MaxLength="300" runat="server" Width="300"></asp:TextBox>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: right; color: Red; padding-right: 5px; padding-bottom: 10px">* 
                    </td>
                    <td style="padding-right: 10px; padding-bottom: 10px">
                        <asp:Label ID="lblNotificationType" runat="server" Text="Notification Type: "></asp:Label>
                    </td>
                    <td style="padding-bottom: 10px">
                        <asp:DropDownList ID="ddlNotificationType" runat="server">
                            <asp:ListItem Text="News Article" Value="1"></asp:ListItem>
                            <asp:ListItem Text="Sliding System Notification" Value="0"></asp:ListItem>
                        </asp:DropDownList>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: right; color: Red; padding-right: 5px; padding-bottom: 10px">* 
                    </td>
                    <td id="tdLblStartDate" style="display: block;">
                        <asp:Label ID="lblStartDate" runat="server" Text="Start Date"></asp:Label>
                    </td>
                    <td>
                        <asp:TextBox ID="txtDateStart" runat="server" Font-Size="8pt" Width="100px"></asp:TextBox>
                    </td>
                </tr>
                <tr>
                    <td style="text-align: right; color: Red; padding-right: 5px; padding-bottom: 10px">* 
                    </td>
                    <td id="tdLblEndDate" style="display: block;">
                        <asp:Label ID="lblEndDate" runat="server" Text="End Date"></asp:Label>
                    </td>
                    <td id="tdDPEndDate">
                        <asp:TextBox ID="txtDateEnd" runat="server" Font-Size="8pt" Width="100px"></asp:TextBox>
                    </td>
                </tr>
                <tr style="display:none;" id="trTimeZone">
                    <td style="text-align: right; color: Red; padding-right: 5px; padding-bottom: 10px">* 
                    </td>
                    <td style="padding-bottom: 10px">
                        <asp:Label ID="lblTimeZone" runat="server" Text="Time Zone"></asp:Label>
                    </td>
                    <td style="padding-bottom: 10px">
                        <asp:DropDownList ID="ddlTimeZone" runat="server"></asp:DropDownList>
                    </td>
                </tr>
                <tr>
                    <td style="padding-bottom: 10px" style="padding-bottom: 10px"></td>
                    <td>
                        <asp:Label ID="lblActive" runat="server" Text="Active"></asp:Label>
                        <asp:CheckBox ID="cbActive" runat="server" Checked="true" />
                    </td>
                    <td style="padding-bottom: 10px">
                    </td>
                </tr>
            </table>

            <div id="divNewsBodyContainer" class="attributesRow" style="vertical-align: top;">
                <div id="divNewsBodyHeader" class="pageContentHeader" style="padding: 5px;">
                    <div class="attributesLabel" style="padding-left: 5px; display: inline;">
                        Body:
                    </div>
                    <span id="labelMessage" style="color:red; padding-left:15px;"></span>
                </div>
                <div id="divNewsBody" class="attributesValue" style="padding: 10px 0px 10px 20px;">
                    <textarea id="textNewsBody" runat="server" rows="12" style="width: 98%;"></textarea>
                </div>
            </div>

            <div style="display: none;">
                <asp:TextBox ID="txtNews" runat="server"></asp:TextBox>
            </div>
        </div>
        <div id="popupFooter" class="PopupFooter">
        <table cellpadding="0" cellspacing="0" style="width:100%; height:100%;">
            <tr>
                <td style="width:100%; text-align:right;">
                    <button id="btnSave" class="button" onmouseover="this.className = 'buttonOver';" onmouseout="this.className = 'button';" onmousedown="this.className = 'buttonClick';" onmouseup="this.className = 'buttonOver';" onclick="saveNews(); return false;">
                        <div>Save</div>
                    </button>
                    <button id="btnCancel" class="button" onmouseover="this.className = 'buttonOver';" onmouseout="this.className = 'button';" onmousedown="this.className = 'buttonClick';" onmouseup="this.className = 'buttonOver';" onclick="closeWindow(); return false;">
                        <div>Close</div>
                    </button>
                </td>
            </tr>
        </table>
    </div>
        <div id="pageDimmer" style="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; background-color: grey; filter: alpha(opacity = 60); display: none;"></div>
        <div id="divSaving" style="width: 250px; position: absolute; left: 30%; top: 30%; background-color: white; border: 1px solid #000000; display: none;">
            <table style="width: 100%;">
                <tr>
                    <td style="height: 30px; vertical-align: middle; padding-left: 10px;">
                        <img src="images/loaders/loader_2.gif" alt="Saving" />
                    </td>
                    <td id="tdMessage" style="vertical-align: middle; white-space: nowrap; height: 100%; width: 98%;">Saving...
                    </td>
                </tr>
            </table>
        </div>

        <script src="Scripts/cleditor/jquery.cleditor.js"></script>

        <script type="text/javascript">
            _newsId = -1;

            $(document).ready(function () {
                $('#txtDateStart').datepicker();
                $('#txtDateEnd').datepicker();

                var w = '99%';// $('#<%=this.textNewsBody.ClientID %>').width();
                var h = 150;
                if (($('#<%=this.textNewsBody.ClientID %>').height() + 30) > 150) {
                h = $('#<%=this.textNewsBody.ClientID %>').height() + 30;
                };

                _newsId = '<%= this._newsID %>';

                $('#<%=this.textNewsBody.ClientID %>').cleditor({ width: w, height: h });

                $('#<%=this.textNewsBody.ClientID %>').cleditor()[0].change(function () { txt_change($('#<%=this.textNewsBody.ClientID %>')); });
                $($('#<%=this.textNewsBody.ClientID %>').cleditor()[0].doc).css('height', (h - 28) + 'px');
                $($('#<%=this.textNewsBody.ClientID %>').cleditor()[0].doc.body).css('height', (h - 26) + 'px');
                $($('#<%=this.textNewsBody.ClientID %>').cleditor()[0].doc.body).css('background-color', '#F5F6CE');
            });

            function closeWindow() {
                popupManager.ActivePopup.Close();
            }

            function saveNews() {
                try {
                    var objNews = {};// new NewsItem();
                    
                    var descr = encodeURIComponent($('#<%=this.textNewsBody.ClientID %>').val());

                    objNews.ArticleTitle = $('#<%=this.txtArticleTitle.ClientID %>').val();
                    objNews.NotificationType = parseInt($('#<%=this.ddlNotificationType.ClientID %> option:selected').val());
                    objNews.StartDate = $('#<%=this.txtDateStart.ClientID %>').val();
                    objNews.EndDate = $('#<%=this.txtDateEnd.ClientID %>').val();
                    objNews.Active = $('#<%=this.cbActive.ClientID %>').prop('checked');
                    objNews.Description = descr;

                    var validationHeader = '<table><tr><td colspan="2" style="font-weight: bold">Required fields missing:</td></tr>';
                    var validationBody = '';
                    if (objNews.ArticleTitle == '') { validationBody += '<tr><td style="text-align: right; color: Red; padding-right: 5px;">*</td><td>Article Title needed.</td></tr>'; }
                    if (objNews.NotificationType == -1) { validationBody += '<tr><td style="text-align: right; color: Red; padding-right: 5px;">*</td><td>Notification Type needed.</td></tr>'; }
                    if (objNews.StartDate == '') { validationBody += '<tr><td style="text-align: right; color: Red; padding-right: 5px;">*</td><td>Start Date needed.</td></tr>'; }
                    if (objNews.EndDate == '') { validationBody += '<tr><td style="text-align: right; color: Red; padding-right: 5px;">*</td><td>End Date needed.</td></tr>'; }
                    if (validationBody.length > 0) {
                        validationBody += '</table>';
                        MessageBox(validationHeader + validationBody);
                    } else {
                        try {
                            PageMethods.SaveNews(
                                objNews, _newsId, save_done, on_error);
                        } catch (e) {
                            MessageBox('An error occurred gathering data to save.' + '\n' + e.message, 'Save Error');
                        }
                    }
                } catch (ex) {

                }
            }

            function save_done(result) {
                var saved = false;
                var id = 0;
                var errorMsg = '';

                try {
                    var obj = jQuery.parseJSON(result);

                    if (obj.toUpperCase() == 'TRUE') {
                        MessageBox('News Article has been saved. ');
                    } else {
                        MessageBox('Failed to save News Article.', 'Save Failed');
                    }
                }
                catch (e) { }
            }

            function on_error(result) {
                var resultText = 'An error occurred when communicating with the server';/*\n' +
					'readyState = ' + result.readyState + '\n' +
					'responseText = ' + result.responseText + '\n' +
					'status = ' + result.status + '\n' +
					'statusText = ' + result.statusText;*/

                MessageBox('save error:  \n' + resultText, 'Server Error');
            }

            function txt_change(sender) {
                clearMessage();

                var original_value = '', new_value = '';
                if ($(sender).attr('original_value')) {
                    original_value = $(sender).attr('original_value');
                }

                new_value = $(sender).val();

                if (new_value != original_value) {
                    //activateSaveButton();
                }
            }

            function clearMessage() {
                $('#labelMessage').text('');
                $('#labelMessage').hide();
            }
        </script>

    </form>
</body>
</html>
